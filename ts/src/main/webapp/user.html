<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="csrf-token"
	content="WLiEfeSJaRU4DCNQDumn1Ji5znkHotmL6lTYW18f">
<title>个人主页-TS.COM</title>
<link type="application/opensearchdescription+xml" href="opensearch.xml"
	title="TS.COM" rel="search" />
<link media="all" type="text/css" rel="stylesheet"
	href="/ts/assets/libs/uikit/css/uikit.min.css">
<link media="all" type="text/css" rel="stylesheet"
	href="/ts/assets/libs/uikit/css/components/slider.min.css">
<link media="all" type="text/css" rel="stylesheet"
	href="/ts/assets/libs/uikit/css/components/slidenav.min.css">
<link media="all" type="text/css" rel="stylesheet"
	href="/ts/assets/libs/uikit/css/components/slideshow.min.css">
<link media="all" type="text/css" rel="stylesheet"
	href="/ts/assets/libs/uikit/css/components/tooltip.min.css">
<link media="all" type="text/css" rel="stylesheet"
	href="/ts/assets/libs/uikit/css/components/notify.min.css">
<link media="all" type="text/css" rel="stylesheet"
	href="/ts/assets/css/animate.css">
<link media="all" type="text/css" rel="stylesheet"
	href="/ts/assets/css/introjs.css">
<link media="all" type="text/css" rel="stylesheet"
	href="/ts/assets/css/style.css">
<link media="all" type="text/css" rel="stylesheet"
	href="/ts/assets/libs/select2/css/select2.css">
	<link rel="stylesheet" type="text/css" href="/ts/assets/css/wangEditor.min.css">
<style type="text/css">
.plbtn{
    float: right;
    margin-right: 10%;
}
p{ word-wrap:break-word; word-break:normal;}
</style>
<script type="text/javascript">
	var user_id = 4501;
	var play_token = '5912554fdec6cZDUDF';
	var username = 'Doom4J';
	var head_pic = '/img/avatar.jpg';
	paceOptions = {
		restartOnRequestAfter : false
	}
</script>
<script src="/ts/assets/js/jquery-2.1.4.min.js"></script>
<script src="/ts/all/all.js"></script>
<script src="/ts/vendor/Parsley/dist/parsley.min.js"></script>
<script src='//cdn.bootcss.com/socket.io/1.7.3/socket.io.min.js'></script>
<link rel="icon" href="/ts/favicon.ico"
	type="image/x-icon" />
<!--[if lt IE 9]> <script src="/ts/assets/js/html5shiv/3.7.3/html5shiv.min.js"></script> <script src="/ts/assets/js/respond.js/1.4.2/respond.min.js"></script> <![endif]-->
</head>
<body>
	<div id="scroll"></div>
	<div id="h5music" class="jp-jplayer"></div>
	<div class="background-cover-img img-ucenter"></div>
	<div class="background-cover"></div>
	<a href="/ts" title="TS.COM" class="s-logo"><i
		class="logo"></i></a>
	<nav class="nav-header">
		<ul class="quick-menu">
			<li data-uk-dropdown><a href="javascript:;"><i
					class="iconfont icon-user"></i> <span class="i uk-icon-angle-down"></span>
			</a>
			<div class="lomenu uk-dropdown uk-dropdown-flip dropdown-arrow-up">
					<ul class="uk-nav uk-nav-dropdown">
						<li><a href="#"><i
								class="iconfont icon-user"></i> 我的主页</a></li>
						<li><a href="#"><i
								class="iconfont icon-mail"></i> 我的消息</a></li>
						<li class="uk-nav-divider"></li>
						<li><a href="/ts/user/logout"><i
								class="iconfont icon-iconexit"></i> 退出</a></li>
					</ul>
				</div></li>
			<li class="uk-visible-small"><a href="javascript:;"
				class="nav-menu-xs" data-uk-toggle="{target:'.menu-xs'}"> <span></span>
					<span></span> <span></span>
			</a></li>
		</ul>
	</nav>
	<div class="header">
		<div class="h-title">
			<div class="uk-container uk-container-center">
				<h2 class="uk-h2">
					<span class="h2-icon"></span> Doom4J <span class="h2-icon">
					</span> <a href="#"
						class="uk-button uk-button-small uk-button-borderd"><i
						class="uk-icon-pencil"></i> 编辑</a> <small class="my-intro">个人介绍：暂无介绍</small>
				</h2>
				<div class="header-socal">
					<a href="#" class="uk-button"><i class="uk-icon-weibo"></i></a> <a
						href="#" class="uk-button"><i class="uk-icon-qq"></i></a> <a
						href="#" class="uk-button"><i class="iconfont icon-douban"></i></a>
				</div>
			</div>
		</div>
	</div>
	<script>
		$(function() {
			var oldStatus = '';
			$('.h-title').on(
							'mouseover',
							'.cancel',
							function() {
								oldStatus = $(this).html();
								$(this).html('<i class="iconfont icon-quxiaoguanzu"></i> 取消关注');
							});
			$('.h-title').on('mouseout', '.cancel', function() {
				if (oldStatus != '')
					$(this).html(oldStatus);
			});
			$('.attention').click(function() {
								var _this = $(this);
								var uid = _this.attr('uid');
								$('.cancel').unbind('mouseover').unbind('mouseout');
								$.ajax('/attention/guanzhu',
										{
											type : "post",
											dataType : "json",
											data : {
												id : uid
											},
											success : function(res) {
												if (res.error == 0) {
													if (res.type == 1) {
														_this.addClass('cancel').html('<i class="iconfont icon-yiguanzhu fans"></i> 已关注');
													} else if (res.type == 2) {
														_this.removeClass('cancel').html('<i class="iconfont icon-jiaguanzhu"></i> 关注');
													}
												}
											}
										});
							});
		});
	</script>
	<div class="home-layer">
		<div class="uk-container uk-container-center">
			<div class="big-avatar">
				<img src="/ts/uploads/avatar.jpg" alt=""
					class="animated rotateIn">
			</div>
			<div class="uk-width-4-10 uk-push-3-10 proifo wow fadeInUp"
				data-wow-delay="0.4s">
				<div class="uk-grid">
					<div class="uk-width-1-3">
						<a href="#"> <strong id="booktotal">0</strong>
							<span>动态</span>
						</a>
					</div>
					<div class="uk-width-1-3">
						<a href="#"> <strong>0</strong>
							<span>关注</span>
						</a>
					</div>
					<div class="uk-width-1-3">
						<a href="#"> <strong>0</strong>
							<span>粉丝</span>
						</a>
					</div>
				</div>
			</div>
			<ul class="uk-list localifo wow fadeInUp" data-wow-delay="1s">
				<li><i class="iconfont icon-local"></i> 暂未设置 <i
					class="iconfont icon-xingzuo"></i> 设置生日有惊喜哦</li>
				<li><i class="iconfont icon-flag"></i> 2017-05-07 加入</li>
				<li><i class="iconfont icon-nianling"></i> 年龄： -</li>
			</ul>
			<ul class="uk-list home-nav">
				<li class="uk-active"><a
					href="#">动态</a></li>
				<li><a href="#">消息</a></li>
				<li><a href="#">喜欢</a></li>
				<li><a href="#">收藏</a></li>
			</ul>
			<div class="uk-panel uk-panel-box home-dynamic"
				data-uk-scrollspy="{cls:'animated', target:'.uk-comment', delay:550}"
				id="posts-list">
				<ul id="mine" class="uk-comment-list">
					<article class="uk-comment">
						<p style="color: white;">暂无动态</p>
					</article>
				</ul>
			</div>
		</div>
	</div>
	<script src="/ts/assets/libs/select2/js/select2.min.js"></script>
	<script type="text/javascript">
		$(function() {
			$(document).ready(function() {
				$(".slec-single").select2({
					placeholder : "请选择",
					allowClear : true,
					minimumResultsForSearch : Infinity,
					width : '88%'
				});
			});
			$('#private-form .at').click(
					function() {
						$('#private-content').insertContent(
								'@' + $(this).text() + ' ');
					});
			$('#private-form .emtitm').click(
					function() {
						$('#private-content').insertContent(
								'[[' + $(this).attr('title') + ']]');
					});
			$('#private-form').on('submit', function() {
				var users = $('select[name^=to_users').val();
				if (!users) {
					layer.msg('请选择消息接收者');
				}
				var content = $('#private-content').val();
				if (!content) {
					layer.msg('请输入内容');
				}
				$.ajax('/message/send', {
					type : "POST",
					dataType : "json",
					data : $('#private-form').serialize(),
					success : function(res) {
						if (res.error == 0) {
							$('#private-form')[0].reset();
							layer.msg('消息发送成功');
						} else {
							UIkit.notify('系统或参数错误，请稍后再试', {
								status : 'danger'
							});
						}
					}
				});
				return false;
			});
		});
	</script>
	<div class="go-up">
		<a href=""><i class="uk-icon-chevron-up"></i></a>
	</div>
	<script>
		$(function() {
			$('.search-type').on(
					'click',
					function() {
						$(this).addClass('uk-active').siblings().removeClass(
								'uk-active');
						$('#search-type').val($(this).text());
						$('#web-search-content').val('');
					});
			$('#website-search-form').on('submit', function() {
				if ($('#web-search-content').val() == '') {
					return false;
				}
			});
		});
	</script>
	<script
		src="/ts/assets/js/wangEditor.min.js"></script>
	<script type="text/javascript">
		var next_page_url = "";
		var end = 0;
		var loading = null;
		function show() {
			if ($(window).scrollTop() + $(window).height() >= $(document).height()) {
				if (end == 1) {
					return false;
				}
				if (next_page_url != '') {
					ajaxRead(next_page_url, 'posts-list');
				} else {
					end = 1;
					$('#posts-list').append('<p class="uk-text-center" style="color:white;">没有更多了<p>');
				}
			}
		};
		function ajaxRead(url, id) {
			$.ajax({
						dataType : 'json',
						url : url,
						data : {},
						beforeSend : function() {
							loading = layer.load(2, {
								shade : 0
							});
						},
						success : function(res) {
							layer.close(loading);
							if (res.error == 0) {
								$('#' + id).append(res.html);
								if (res.end == 0) {
									next_page_url = res.next_page_url;
								} else {
									end = 1;
									$('#' + id).append('<p class="uk-text-center" style="color:white;">没有更多了<p>');
								}
							}
						}
					});
		};
		function getMine(page){
			$.ajax({
				dataType : 'json',
				url : '/ts/book/getmine',
				data : {'page':page},
				success : function(res) {
					if (res.status == 1000) {
						$('#booktotal').html(res.total);
						var bookmine = eval(res.bookmine);
						var booklis = "";
						$.each(bookmine,function(n,value){
							booklis += "<li><article class='uk-comment uk-comment-primary'><div style='margin-left: 20px' class='uk-comment-meta'> "+
							value.markdate+" </div><div id='cnt"+value.id+"' style='margin-left: 20px;' class='uk-comment-body'><p >"+
							value.text+"</p></div><div bid='"+value.id+"' id='pl"+value.id+"' style='margin-left: 20px;height:30px' class='uk-comment-body'></div><button id='btn"+value.id+"' bid='"+
							value.id+"' onclick='doEdit(this)' type='button' class='plbtn uk-button'>修改</button></article></li><hr style='border-top: 1px solid #8a7777;'/>";
						});
						$('#mine').html(booklis);
					}else{
						location.href = "/";
					}
				}
			});
		};
		$(window).bind('scroll', function() {
			show()
		});
	</script>
	<script
		src="/ts/vendor/jquery_lazyload/jquery.lazyload.min.js"></script>
	<script type="text/javascript">
		$(function() {
			$("img.lazy1").lazyload({
				event : "sporty"
			});
			getMine(0);
			$('#i-skin').on(
							'click',
							'.skin-image',
							function() {
								var skin_id = $(this).attr('val');
								if ($(this).hasClass('uk-active')) {
									$(this).removeClass('uk-active');
									if (user_id > 0) {
										updateSkin(0);
									} else {
										$.cookie('skin_id', 0);
									}
									$('.background-cover-img').css(
											'background', '').addClass(
											'img-index');
								} else {
									$('#i-skin').find('.skin-image')
											.removeClass('uk-active');
									$(this).addClass('uk-active');
									$('.background-cover-img').css(
													'background',
													'url('+ $(this).find('img').attr('data-src')+ ') no-repeat fixed center top / cover');
									if (user_id > 0) {
										updateSkin(skin_id);
									} else {
										$.cookie('skin_id', skin_id, {
											expires : 7
										});
									}
								}
							});
			$('.icon-skin').on('click', function() {
				$("img.lazy1").trigger("sporty");
			});
		});
	</script>
	<script type="text/javascript">
	(function () {
	    // 获取 wangEditor 构造函数和 jquery
	    var E = window.wangEditor;
	    var $ = window.jQuery;
	    // 用 createMenu 方法创建菜单
	    E.createMenu(function (check) {
	        // 定义菜单id，不要和其他菜单id重复。编辑器自带的所有菜单id，可通过『参数配置-自定义菜单』一节查看
	        var menuId = 'quxiao';
	        var menuIdtijiao = 'tijiao';
	        // check将检查菜单配置（『参数配置-自定义菜单』一节描述）中是否该菜单id，如果没有，则忽略下面的代码。
	        if (!check(menuId)) {
	            return;
	        }
	        // this 指向 editor 对象自身
	        var editor = this;
	        // 创建 menu 对象
	        var menu = new E.Menu({
	            editor: editor,  // 编辑器对象
	            id: menuId,  // 菜单id
	            title: '取消', // 菜单标题
	            // 正常状态和选中状态下的dom对象，样式需要自定义
	            $domNormal: $('<a href="#" tabindex="-1">取消</a>'),
	            $domSelected: $('<a href="#" tabindex="-1" class="selected">取消</a>')
	        });
	        // 菜单正常状态下，点击将触发该事件
	        menu.clickEvent = function (e) {
	            $('#pl'+bid).empty();
	            $('#btn'+bid).show();
	            ccnt = 0;
	            editor.destroy();
	            $('.wangEditor-container').remove();
	        };
	        
	        var menusave = new E.Menu({
	            editor: editor,  // 编辑器对象
	            id: menuIdtijiao,  // 菜单id
	            title: '保存', // 菜单标题
	            // 正常状态和选中状态下的dom对象，样式需要自定义
	            $domNormal: $('<a href="#" tabindex="-1">保存</a>'),
	            $domSelected: $('<a href="#" tabindex="-1" class="selected">保存</a>')
	        });
	        menusave.clickEvent = function (e) {
	            $('#btn'+bid).show();
	            alert($('#pl'+bid).html());
	            var txt = $('#pl'+bid).html();
	            var idx = txt.indexOf("<p></p>");
	            while (idx>=0){
	            	txt = txt.replace("<p></p>",'');
	            	idx = txt.indexOf("<p></p>");
	            }
	            txt = txt.replace("<p><br></p>",'');
	            $.ajax({
	    			dataType : 'json',
	    			url : '/ts/book/edit/'+bid,
	    			type : 'POST',
	    			data : {'txt':txt},
	    			success : function(res) {
	    				if (res.status == 1000) {
	    					$('#cnt'+bid).html(txt);
	    					UIkit.notify('修改成功',{status : "success"});
	    				}else if(res.status == 1004){
	    					UIkit.notify('登录超时',{status : "danger"});
	    				}else{
	    					UIkit.notify('修改失败',{status : "danger"});
	    				}
	    			}
	    		});
	            $('#pl'+bid).empty();
	            ccnt = 0;
	            editor.destroy();
	            $('.wangEditor-container').remove();
	        };
	        editor.menus[menuId] = menu;
	        editor.menus[menuIdtijiao] = menusave;
	    });

	})();
	var bid = -1;
	var editor;
	var ccnt = 0;
	function doEdit(element){
		bid = element.getAttribute("bid");
		var div = document.getElementById('pl'+bid);
		if(0==ccnt){
			editor = new wangEditor(div);
			editor.config.menus = ['img' ,'emotion','|','quxiao','|','tijiao'];
	    	editor.create();
	    	editor.$txt.html($('#cnt'+bid).html());
	    	$(element).hide();
	    	ccnt = 1;
		}
	};
	function submitpl(txt,id){
		$.ajax({
			dataType : 'json',
			url : '/ts/book/edit/'+id,
			data : {'txt':txt},
			success : function(res) {
				if (res.status == 1000) {
					UIkit.notify('修改成功',{status : "success"});
				}else if(res.status == 1004){
					UIkit.notify('登录超时',{status : "danger"});
				}else{
					UIkit.notify('修改失败',{status : "danger"});
				}
			}
		});
	}
	$.ajaxSetup({
		headers : {
			'X-CSRF-TOKEN' : $('meta[name="csrf-token"]').attr('content')
		}
	});
	</script>
</body>
</html>